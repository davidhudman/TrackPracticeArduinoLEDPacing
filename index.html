<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>jQuery Mobile Bootstrap Theme</title>
		<link rel="stylesheet" href="themes/Bootstrap.css">
		<link rel="stylesheet" href="jquery.mobile-1.4.5/jquery.mobile.structure-1.4.5.min.css" />
		<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
		<script src="jquery-1.8.2.min.js"></script>
		<script src="jquery.mobile-1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <link rel="stylesheet" href="Mobile-friendly-Numeric-Keypad-Plugin-For-jQuery-NumPad/jquery.numpad.css">
		<script src="Mobile-friendly-Numeric-Keypad-Plugin-For-jQuery-NumPad/jquery.numpad.js"></script>
		<script>
		    // Numpad global variable stuff
		    $.fn.numpad.defaults.gridTpl = '<table class="ui-bar-a"></table>';
		    $.fn.numpad.defaults.backgroundTpl = '<div class="ui-popup-screen ui-overlay-a"></div>';
		    $.fn.numpad.defaults.displayTpl = '<input data-theme="b" type="text" />';
		    $.fn.numpad.defaults.buttonNumberTpl = '<a data-role="button" data-theme="b"></a>';
		    $.fn.numpad.defaults.buttonFunctionTpl = '<a data-role="button" data-theme="a"></a>';
		    $.fn.numpad.defaults.onKeypadCreate = function () { $(this).enhanceWithin(); };

		    var numPacers = 10;
		    var pacerButton = [];
		    var advancedButtonPressed = false;
		    var onMassesViewSequence = true;
		    var onExistingPacerSequence = false;
		    var masterPacerSelected = 99;
		    var lapTimeInputConstraints = [1, 900];
		    var pinVar = 111;
		    colorArray = ["black", "white", "red", "orange", "yellow", "green", "blue", "purple"];
		    massesViewSequence = ["start", "pin", "colorEntry", "timeEntry", "simpleControls", "activePacers"];
		    massesCurrentView = massesViewSequence[0];
		    window.onload = Pinstatus;

		    (function ($, window) {
		        $.fn.replaceOptions = function (options) {
		            var self, $option;

		            this.empty();
		            self = this;

		            $.each(options, function (index, option) {
		                $option = $("<option></option>")
                          .attr("value", option.value)
                          .text(option.text);
		                self.append($option);
		            });
		        };
		    })(jQuery, window);

		    function Pinstatus() {
		        morestatus();
		    }

		    // PLEASE REMOVE THIS: NO LONGER IN USE - request a designated pacer
		    function requestPacer() {
		        var xhttp = new XMLHttpRequest();
		        var feedbackText;   // holds text from Arduino - this will be your pacer index
		        xhttp.onreadystatechange = function () {
		            if (xhttp.readyState == 4 && xhttp.status == 200) {
		                feedbackText = xhttp.responseText;
		                document.getElementById("newFeedBack").innerHTML = feedbackText;
		                if (feedbackText == "-1") {
		                    showPacersOccupiedView();
		                    setTimeout(showFirstTimeUserStartView, 4000);
		                }
		                else {
		                    masterPacerSelected = feedbackText;
		                }
		            }
		        };
		        xhttp.open("GET", "/arduino/9/0/0", true);
		        xhttp.send();
		    }

		    // reads DataLogger.txt file that is updated with by Yun feedback
		    function readFeedbackFile() {
		        var xhttp = new XMLHttpRequest();
		        var feedbackText;   // holds text from datalog.txt file
		        xhttp.onreadystatechange = function () {
		            if (xhttp.readyState == 4 && xhttp.status == 200) {
		                feedbackText = xhttp.responseText;
		                parseFeedbackFile(feedbackText);
		                document.getElementById("newFeedBack").innerHTML = feedbackText;
		            }
		        };
		        xhttp.open("GET", "datalog.txt", true);
		        xhttp.send();
		    }

		    // Makes a request to Arduino for feedback
		    function morestatus() {
		        readFeedbackFile();
		    }

		    // Show feedback from the Arduino
		    function updateasyncstatus() {
		        var pacer = [];
		        if ((request.readyState == 4) && (request.status == 200)) {
		            result = request.responseText;
		            var pacerIndex = masterPacerSelected;

		            if (pacerIndex != 99) {
		                fullset = result.split("#");
		                for (i = 0; i < fullset.length; i++) {
		                    myset = fullset[i].split("=");
		                    pacer[i] = {
		                        lapTime: myset[0], color: colorArray[myset[1] % colorArray.length], text: "Pacer "
                                    + i + " - " + myset[0] + " - " + colorArray[myset[1] % colorArray.length]
		                    }
		                }

		                newSet = fullset[pacerIndex].split("=");
		                secondsPerLap = newSet[0];
		                color = colorArray[newSet[1]];
		                document.getElementById("description").innerHTML = secondsPerLap + " | " + color;
		                document.getElementById("feedbackData").innerHTML = "Lap Time: " + secondsPerLap + ", Color: " + color;
		            }
		            else {
		                document.getElementById("description").innerHTML = "Lights: " + result;
		                document.getElementById("feedbackData").innerHTML = "Lights: " + result;
		            }
		        }
		        testCommand();
		    }

		    // send an extra command in case Arduino is lagging because it is still waiting for something
		    function testCommand() {
		        requestCommand(-1, 0, 0);
		    }

		    // sends GET request for the commands that the Yun will accept; parameters: x - command, y - pacerIndex, z - value
		    function requestCommand(x, y, z) {
		        if (masterPacerSelected == 99) {		// If you're in "Coach Mode" where you can control all pacers at once, as well as update the database just like below.
		            y = masterPacerSelected;
		            /*
					// old Arduino command request
					var xhr = new XMLHttpRequest();
					xhr.open("GET", "/arduino/" + x + "/" + y + "/" + z, false);
					xhr.send();
					$("#demo").text("/arduino/" + x + "/" + y + "/" + z);
					setTimeout(readFeedbackFile, 4000);*/
		        }
		        var request = new XMLHttpRequest();
		        request.onreadystatechange = function () {
		            if (request.readyState == 4 && request.status == 200) {
		                // if (request.responseText != "incorrect") {
		            }
		        };

		        request.open("GET", "updateDBandYun.php?command=" + x + "&pacerIndex=" + y + "&value=" + z + "&pin=" + pinVar, true);
		        request.send();
		    }

		    // PLEASE REMOVE THIS - NO LONGER IN USE: handle new pacer times
		    function newPacerTime(val) {
		        var newPacerTimeNum = 0;
		        var pacerIndexforTimeSet = masterPacerSelected;

		        requestCommand(7, pacerIndexforTimeSet, val);
		        $("#pacerTimeInput").val("Enter pacer time in seconds");
		    }

		    $(document).ready(function () {
		        // handles pacer action commands - clear, reset, backwards, new number of lights, change in speed, etc.
		        $(".submitButton, .submitButton3, .speedChangeButton, #lightsSubmit, .simpleViewActionButtons").click(function () {
		            var commandURL = parseInt($(this).attr("url"), 10);
		            var pacerIndex = parseInt(masterPacerSelected, 10);
		            var newNum = parseFloat($(this).attr("otherNum"));
		            var signlessNum = parseFloat($("#lightsNumberInput").val());

		            switch (commandURL) {
		                case 6:         // light change
		                    newNum = signlessNum;
		                    break;
		                case 8:         // speed change
		                    if (signlessNum <= 0.0) {
		                        return;
		                    }
		                    else {
		                        newNum = signlessNum * newNum;   // multiply by newNum because '$(this).attr("otherNum")' is actually the "sign" of the number
		                    }
		                    break;
		                default:
		                    break;
		            }

		            requestCommand(commandURL, pacerIndex, newNum);
		        });

		        $("#resetYunFromDbButton").click(function () {
		            var request = new XMLHttpRequest();
		            request.onreadystatechange = function () {
		                if (request.readyState == 4 && request.status == 200) {
		                    // if (request.responseText != "incorrect") {
		                }
		            };

		            request.open("GET", "updatePacers.php?needYunSyncWithDB=1", true);
		            request.send();
		        });

		        // Handles the submission of the normal view lap time
		        $("#pacerTimeSubmit").click(function () {
		            commandURL = parseInt($(this).attr("url"), 10);
		            pacerIndex = parseInt(masterPacerSelected, 10);
		            newNum = $("#pacerTimeInput").val();
		            if (newNum < lapTimeInputConstraints[0] || newNum > lapTimeInputConstraints[1]) {
		                if (newNum < lapTimeInputConstraints[0])
		                    $("#pacerTimeInput").val(lapTimeInputConstraints[0]);
		                else
		                    $("#pacerTimeInput").val(lapTimeInputConstraints[1]);
		            }
		            else {
		                requestCommand(commandURL, pacerIndex, newNum);
		                forwardOneView();
		            }
		        });

		        // GET RID of this function! - Handles the submission of the normal view lap time
		        $("#pacerTimeSubmitSimple").click(function () {
		            commandURL = parseInt($(this).attr("url"), 10);
		            pacerIndex = parseInt(masterPacerSelected, 10);
		            newNum = $("#pacerTimeInputSimple").val();
		            requestCommand(commandURL, pacerIndex, newNum);
		        });

		        // handles longpress of all buttons to show their help text
		        $(".submitButton3, #lightsSubmit, .speedChangeButton, #advancedButton, #helpButton, #helpButtonMasses").on("taphold", function (event) {
		            var text = $(this).attr("help");
		            alert(text);
		        });

		        // handles longpress for of description button to make it into a reset delay button and vice versa
		        $("#tpHeader").on("taphold", function (event) {
		            if (onMassesViewSequence == true) {
		                showNormalView();
		                advancedButtonPressed = false;
		                onMassesViewSequence = false;
		            }
		            else {
		                var rstBtnUrl = $("#resetButton").attr("url");
		                $("#demo").text("button might be doing something");
		                if (rstBtnUrl == "1") {
		                    $("#resetButton").attr("url", "2");
		                    $("#resetButton").attr("data-icon", "clock");
		                    $("#demo").text("button is now delay");
		                    alert("Reset button will now reset pacers on a delay.");
		                }
		                else {
		                    $("#resetButton").attr("url", "1");
		                    $("#resetButton").attr("data-icon", "refresh");
		                    $("#demo").text("button is now reset");
		                    alert("Reset button will now reset pacers immediately when pressed.");
		                }
		            }
		        });

		        // handles longpress of feedbackParagraph to make it request feedback
		        $("#feedbackData").on("taphold", function (event) {
		            $("#feedbackData").text("Just requested updated data.");
		            askForFeedback();
		            readFeedbackFile();
		        });

		        // handles longpress of advancedButton in order to show the first time user start view
		        $("#advancedButton").on("taphold", function (event) {
		            showFirstTimeUserStartView();
		        });

		        // reveals the secret demo field whenever you click the advancedButton
		        $("#advancedButton").click(function () {
		            if (onMassesViewSequence == true) {
		                // put something here if you want the advanced button to do something special when the first time user clicks it
		            }
		            else {
		                if (advancedButtonPressed == false) {
		                    showEverything();
		                    advancedButtonPressed = true;
		                }
		                else {
		                    showNormalView();
		                    advancedButtonPressed = false;
		                }
		            }
		        });

		        // Display help when the help button is clicked
		        $("#helpButton, #helpLink, #helpButtonMasses").click(function () {
		            var text = $(this).attr("help");
		            alert(text);
		        });

		        // hide everything when the allPacersButton is clicked except the group of pacerButtons and its escape button
		        $("#allPacersButton").click(function () {
		            showPacerButtonsView();
		        });

		        // Clear the contents of the new pacer time field when clicked so the user can type theirs
		        $("#pacerTimeInput, #lightsNumberInput, #pinInputField").click(function () {
		            $(this).val("");
		        });

		        // Takes you back to the normal view
		        $("#demo, #tpHeader").click(function () {
		            if (onMassesViewSequence == true) {
		                // do nothing
		            }
		            else {
		                showNormalView();
		                advancedButtonPressed = false;
		            }
		        });

		        // Takes you back to the normal view or the previous page if you're on the first time user sequence
		        $("#viewEscapeButton").click(function () {
		            if (onMassesViewSequence == true) {
		                backOneView();
		            }
		            else {
		                showNormalView();
		            }
		        });

		        // Takes you to the create PIN view
		        $("#newPacerButton").click(function () {
		            forwardOneView();
		        });

		        // Takes you to a modified version of the showPacerButtonsView (or it will soon)
		        $("#existingPacerButton").click(function () {
		            // showPacerButtonsView();
		            onExistingPacerSequence = true;
		            chooseExistingPacerView();

		        });

		        function chooseExistingPacerView() {
		            hideEverything();
		            $("#existingPacerSelectHeader").show();
		            $("#pacerButtonView").show();
		            $("#allPacersButton").hide();
		        }

		        // Takes you a view where the user can edit their new pacer
		        $("#createPinSubmit").click(function pinCreated() {
		            if (isPinFormatValid() == true) {
		                if (onExistingPacerSequence == true) {

		                    pinVar = $("#pinInputField").val();
		                    var xhttp = new XMLHttpRequest();
		                    xhttp.onreadystatechange = function () {
		                        if (xhttp.readyState == 4 && xhttp.status == 200) {
		                            if (xhttp.responseText != "incorrect") {
		                                pinSubmitText = xhttp.responseText;
		                                masterPacerSelected = pinSubmitText;
		                                alert(masterPacerSelected);
		                                showPacerTimeInputView();
		                                // requestPacer();
		                            }
		                            else {
		                                alert(xhttp.responseText);  // incorrect PIN
		                            }
		                        }
		                    };
		                    xhttp.open("GET", "verifyPIN.php?pin=" + pinVar + "&pacerIndex=" + masterPacerSelected, true);
		                    xhttp.send();
		                }
		                else { 	// if the person is just creating a brand new pacer
		                    pinVar = $("#pinInputField").val();
		                    var xhttp = new XMLHttpRequest();
		                    xhttp.onreadystatechange = function () {
		                        if (xhttp.readyState == 4 && xhttp.status == 200) {
		                            if (xhttp.responseText != "incorrect") {
		                                masterPacerSelected = xhttp.responseText;
		                                alert(masterPacerSelected);
		                                showPacerTimeInputView();
		                            }
		                            else {
		                                alert(xhttp.responseText);  // incorrect PIN
		                            }
		                        }
		                    };
		                    xhttp.open("GET", "verifyPIN.php?pin=" + pinVar + "&pacerIndex=" + masterPacerSelected + "&needNewPacer=1", true);
		                    xhttp.send();
		                    // forwardOneView();
		                }
		            }
		            else {
		                alert("Please enter 3 digits");
		            }
		        });

		        // Updates the paragraph with new feedback
		        $("#newFeedBack").click(function () {
		            readFeedbackFile();
		        });

		        // Reacts to click of pacerSelect button
		        $("#pacerSelect").click(function () {
		            showPacerButtonsView();
		        });

		        // Reacts to click of colorSelect Button
		        $("#colorSelect").click(function () {
		            showColorButtonsView();
		        });

		        // Determines view after a pacerButton is clicked
		        $(".pacerButtonClass").click(function () {
		            if (onExistingPacerSequence == true) {
		                masterPacerSelected = $(this).attr("otherNum");
		                showCreatePinView();
		            }
		            else {
		                if (onMassesViewSequence == true) {
		                    showCreatePinView();
		                }
		                else {
		                    showNormalView();
		                    masterPacerSelected = $(this).attr("otherNum");
		                    $("#pacerSelect").text($(this).text());
		                    $("#pacerSelect").attr('style', "background-color:" + $(this).css("background-color")).css('color', $(this).css("color"));
		                    morestatus();
		                }
		            }
		        });

		        // Goes back to normal view after a colorButton is clicked
		        $(".colorButtonClass").click(function () {
		            // showNormalView();
		            var newNum = $(this).attr("otherNum");
		            requestCommand(5, masterPacerSelected, newNum);
		            forwardOneView();
		        });

		        // Reacts to click of writeFileMode Button
		        $("#writeFileMode").click(function () {
		            requestCommand(10, masterPacerSelected, 0);
		        });

		        // Reacts to click of lightStripMode Button
		        $("#lightStripMode").click(function () {
		            requestCommand(11, masterPacerSelected, 0);
		        });

		    });

		    // Do all this stuff as soon as the page loads
		    $(document).ready(function () {
		        // hideAdvancedElements();
		        // showNormalView();
		        assignHelpTextToButtons();
		        colorButtonTextColorFix();
		        // createPacerButtons();
		        $("#pinInputField").numpad({
		            // displayTpl: '<input data-theme="b" type="password" />',
		            hidePlusMinusButton: true,
		            hideDecimalButton: true
		        });
		        $("#pacerTimeInput").numpad({
		            // displayTpl: '<input data-theme="b" type="password" />',
		            hidePlusMinusButton: true,
		            hideDecimalButton: false,
		            decimalSeparator: '.'
		        });
		        $("input[name='radio-choice-1']").change(radioValueChanged);
		        $("#pacerTimeInput, #lightsNumberInput, #pinInputField, #pacerTimeInputSimple").attr('autocomplete', 'off');
		        $(".submitButton, .submitButton2").css('display', 'inline-block');
		        $(".submitButton").css("padding-right", "25px");
		        $(".speedChangeButton").css('display', 'inline-block');
		        $(".speedChangeButton").css("padding-right", "25px");
		        $("#advancedButton").css('display', 'inline-block');
		        $("#advancedButton").css("padding-right", "10px");
		        $("#pacerActionDiv").css("padding-top", "35px");
		        $("#colorDiv").css("padding-top", "35px");
		        //$("button:even").css("background-color", "LightCoral");
		        //$("button:odd").css("background-color", "LightBlue");
		        showFirstTimeUserStartView();
		    });

		    function isPinFormatValid() {
		        var str = "";
		        str = $("#pinInputField").val().split("");
		        if (str.length == 3) {
		            return true;
		        }
		        else {
		            return false;
		        }
		    }

		    // ask Yun to update the datalog.txt file - beware, will cause delays
		    function askForFeedback() {
		        requestCommand(9, masterPacerSelected, 0);
		    }

		    // Parse the datalog.txt file - not working yet
		    function parseFeedbackFile(txtFeedback) {
		        var lights;
		        var pacerIndex = masterPacerSelected;
		        var newPacer = [];

		        fullset = txtFeedback.split("#");
		        for (i = 0; i < fullset.length; i++) {
		            j = i - 1;
		            if (i != 0) {
		                myset = fullset[i].split(",");  // split up the feedback
		                // make your newPacer array instance out of what you just split up
		                newPacer[j] = {
		                    index: myset[0], lapTime: myset[1],
		                    color: colorArray[myset[2] % colorArray.length],
		                    colorText: "background-color:" + colorArray[myset[2] % colorArray.length],
		                    text: "Pacer " + myset[0] + " - " + myset[1]
		                };

		                if (j == pacerIndex) {
		                    $("#newFeedBack2").text("newPacer[i] text: " + newPacer[j].text);
		                    document.getElementById("description").innerHTML = newPacer[j].lapTime + " | " + newPacer[j].color;
		                    document.getElementById("feedbackData").innerHTML = "Lap Time: " + newPacer[j].lapTime + ", Color: " + newPacer[j].color;
		                }

		                $("#pacerButton" + j).text(newPacer[j].text + " secs per lap").attr('style', newPacer[j].colorText);
		                if (myset[2] % colorArray.length == "2" || myset[2] % colorArray.length == "6" || myset[2] % colorArray.length == "7") {
		                    $("#pacerButton" + j).css('color', 'white');
		                }
		                if (myset[1] == "0.00") {
		                    $("#pacerButton" + j).text(newPacer[j].text + " - " + newPacer[j].color).attr('style', "background-color:black").css('color', 'white');
		                }
		            }
		            else {
		                lights = fullset[0];
		            }
		        }

		        if (pacerIndex == 99) {
		            document.getElementById("description").innerHTML = "Lights: " + lights;
		            document.getElementById("feedbackData").innerHTML = "Lights: " + lights;
		        }

		        /*newSet = fullset[pacerIndex].split(",");
		        secondsPerLap = newSet[0];
		        color = colorArray[newSet[1]];
		        document.getElementById("description").innerHTML = secondsPerLap + " | " + color;
		        document.getElementById("newFeedBack2").innerHTML = "Lap Time: " + secondsPerLap + ", Color: " + color;*/
		    }

		    // PLEASE REMOVE THIS - NO LONGER IN USE: Create Pacer Buttons - not working yet
		    function createPacerButtonStuff() {
		        var pacerButtonText;
		        var pacerButtonId;
		        // var txt2 = $("<p></p>").text("Text.");
		        // <a href="index.html" id="allPacersButton" data-role="button" style="background-color:white" data-icon="arrow-l">
		        for (var i = 0; i < 10; i++) {    // later, "10" should be changed to the highest index from the parse of the datalogger.txt file
		            pacerButtonText = "Pacer " + i;
		            pacerButton[i] = $("<button style=\"background-color:white\" data-icon=\"arrow-l\"></button>").text(pacerButtonText);
		            $("#pacerButtonView").append(pacerButton[i]);
		        }
		    }

		    // Define a help attribute for all buttons and dropdowns that can be used when the user requests help
		    function assignHelpTextToButtons() {
		        $("#pacerSelect").attr('help', '**Pacer Selector**\n\nUse this dropdown to select the pacer that you want to use or select "all pacers" to deal with them all at the same time.');
		        $("#clearButton").attr('help', '**Clear Button**\n\nStop the selected pacer(s) from running.');
		        $("#resetButton").attr('help', '**Reset Button**\n\nReset the selected pacer(s) on a delay at your defined starting point.');
		        $("#visibleButton").attr('help', '**Visibility Button**\n\nMake the selected pacer(s) visible or invisible');
		        $("#backwardsButton").attr('help', '**Backwards Button**\n\nMake the selected pacer(s) run backwards or forwards.');
		        $("#colorSelect").attr('help', '**Color Selector**\n\nUse this dropdown to select the color for the currently selected pacer(s).');
		        $("#lightsSubmit").attr('help', '**Lights Number Button**\n\nPressing this button changes the (logical) number of lights in the strip to whatever number is in the textbox below');
		        $("#accelerate").attr('help', '**Accelerate Button**\n\nIncrease the selected pacer(s) speed by the number of seconds per lap that is in the textbox below.');
		        $("#slow").attr('help', '**Slowdown Button**\n\nDecrease the selected pacer(s) speed by the number of seconds per lap that is in the textbox below.');
		        $("#advancedButton").attr('help', '**Advanced Button**\n\nShow the advanced interface.');
		        $("#helpLink").attr('help', '**Help Link**\n\nLong-press any button to find out what it is and what it does.\n\nStart by entering a number in the top-most'
                    + ' textbox to start a pacer at that lap time. Once it\'s running, you can use the clock button to reset it or the x button to stop it.');
		        $("#helpButton").attr('help', '**Help Button**\n\nLong-press any button to find out what it is and what it does.\n\nStart by entering a number in the '
                    + 'top-most textbox to start a pacer at that lap time. Once it\'s running, you can use the clock button to reset it or the x button to stop it.');


		        $("#helpButtonMasses").attr('help', '**Help Button**\n\nLong-press any button to find out what it is and what it does. \n\nYou can use the yellow button to reset your pacer or the red button to stop it.');
		        $("#clearButtonMasses").attr('help', '**Clear Button**\n\nStop your light pacer from running.');
		        $("#resetButtonMasses").attr('help', '**Reset Button**\n\nReset your light pacer on a delay at your defined starting point.');

		    }

		    // change colorButton text color as needed
		    function colorButtonTextColorFix() {
		        for (var i = 0; i < colorArray.length - 1; i++) {
		            j = i + 1;
		            $("#colorButton" + i).attr('otherNum', j).text(colorArray[j]).attr('style', 'background-color:' + colorArray[j]);
		            if (i == 1 || i == 5 || i == 6) {
		                $("#colorButton" + i).css('color', 'white');
		            }
		        }
		    }

		    // create pacer buttons and add them to the page - not working yet
		    function createPacerButtons() {
		        for (var i = 0; i < numPacers; i++) {
		            // elementString = "<a href='#' id='pacerButton" + i + "' class='pacerButtonClass' otherNum='" + i + "' data-role='button' data-icon='star'></a>";
		            // .attr('id', 'pacerButton' + i).addClass('pacerButtonClass').attr('data-role', 'button').attr('href', '#')
		            $("<a>Pacer</a>").appendTo("#pacerButtonView").button().attr('id', 'pacerButton' + i).addClass('pacerButtonClass');
		        }
		    }

		    // Go back one view in the first time user sequence
		    function backOneView() {
		        if (onMassesViewSequence == true) {
		            var i = 0;
		            while (i < massesViewSequence.length) {
		                if (massesCurrentView == massesViewSequence[i]) {
		                    if (i == 0)
		                        break;
		                    if (i != 0) {
		                        massesCurrentView = massesViewSequence[i - 1];
		                        break;
		                    }
		                }
		                i++;
		                if (i == massesViewSequence.length) {
		                    i = 0;
		                }
		            }

		            if (onMassesViewSequence == true && i != 0) {
		                switch (i) {
		                    case 1:
		                        showFirstTimeUserStartView();
		                        break;
		                    case 2:
		                        showCreatePinView();
		                        break;
		                    case 3:
		                        showColorButtonsView();
		                        break;
		                    case 4:
		                        showPacerTimeInputView();
		                        break;
		                    default:
		                        showFirstTimeUserStartView();
		                        break;
		                }
		            }
		        }
		    }

		    // Go forward one view in the first time user sequence
		    function forwardOneView() {
		        if (onMassesViewSequence == true) {
		            var i = 0;
		            while (i < massesViewSequence.length - 1) {
		                if (massesCurrentView == massesViewSequence[i]) {
		                    massesCurrentView = massesViewSequence[i + 1];
		                    break;
		                }
		                i++;
		                //if (i == massesViewSequence.length - 1) {
		                //    i = massesViewSequence.length - 1;
		                //}
		            }

		            if (onMassesViewSequence == true && i != massesViewSequence.length - 1) {
		                switch (i) {
		                    case 0:
		                        showCreatePinView();
		                        break;
		                    case 1:
		                        showColorButtonsView();
		                        break;
		                    case 2:
		                        showPacerTimeInputView();
		                        break;
		                    case 3:
		                        showSimplePacerControlView();
		                        break;
		                    default:
		                        break;
		                }
		            }
		        }
		    }

		    // show a slightly simpler set of options for an end user to control their pacer
		    function showSimplePacerControlView() {
		        hideEverything();
		        $("#viewEscape").show();
		        $("#simpleViewActionButtonsDiv, #advancedButtonDiv").show();
		        // $("#clearButton, #resetButton, #colorSelect, #helpButton").show();
		        massesCurrentView = massesViewSequence[4];
		    }

		    // show pacer time input View
		    function showPacerTimeInputView() {
		        hideEverything();
		        $("#viewEscape").show();
		        $("#pacerTimeInputDiv").show();
		        massesCurrentView = massesViewSequence[3];
		    }

		    // show create PIN view
		    function showCreatePinView() {
		        hideEverything();
		        $("#viewEscape").show();
		        $("#createPinView").show();
		        massesCurrentView = massesViewSequence[1];
		    }

		    // show First Time User Start View "page"
		    function showFirstTimeUserStartView() {
		        hideEverything();
		        $("#firstTimeUserStartDiv").show();
		        onMassesViewSequence = true;
		        massesCurrentView = massesViewSequence[0];
		    }

		    // show Pacer Buttons View "page"
		    function showPacerButtonsView() {
		        hideEverything();
		        $("#pacerButtonView").show();
		        $("#viewEscape").show();
		        if (onMassesViewSequence == true) {
		            massesCurrentView = massesViewSequence[5];
		        }
		    }

		    // show Color Buttons View "page"
		    function showColorButtonsView() {
		        hideEverything();
		        $("#colorButtonView").show();
		        $("#viewEscape").show();
		        if (onMassesViewSequence == true) {
		            massesCurrentView = massesViewSequence[2];
		        }
		    }

		    // View for when the user requests a pacer and there isn't one available
		    function showPacersOccupiedView() {
		        hideEverything();
		        $('#pacerOccupiedDiv').show();
		    }

		    // The view that we want for the end-user when the app loads
		    function showNormalView() {
		        showEverything();
		        hideAdvancedElements();
		        onMassesViewSequence = false;
		    }

		    // show all the advanced elements and hide the advanced button
		    function showAdvancedElements() {
		        $(".advancedElement").show()
		    }

		    // hide all the advanced elements and show the advanced button
		    function hideAdvancedElements() {
		        $(".advancedElement").hide()
		    }

		    // hide everything except the top header
		    function hideEverything() {
		        $(".contentElement").hide();
		    }

		    // show everything - all contentElement class
		    function showEverything() {
		        $(".contentElement").show();
		    }

		    function radioValueChanged() {
		        radioValue = $(this).value();
		        requestCommand(radioValue, 0, 0);
		    }

		    function flipSwitchChange(thisURL) {
		        requestCommand(thisURL, 0, 0);
		    }

		    // End of JavaScript
		</script>
	</head>
	<body>
		<div id="pageWrapper" data-role="page" data-theme="a">
			<div data-role="header" data-position="inline">
				<h1 id="tpHeader">Track Practice</h1>
				<div id="navbar" class="contentElement advancedElement" data-role="navbar">
					<ul>
						<li><a href="index.html" data-icon="home" class="ui-btn-active">Home</a></li>
						<li><a href="buttons.html" data-icon="star">Buttons</a></li>
						<li><a href="listviews.html" data-icon="grid">Lists</a></li>
						<li><a href="nav.html" data-icon="search">Nav</a></li>
						<li><a href="forms.html" data-icon="gear">Forms</a></li>
					</ul>
				</div>
			</div>
            <div id="viewEscape" class="contentElement advancedElement" >
                    <input id="viewEscapeButton" type="button" style="background-color:#E6E6E6" data-icon="arrow-l" value="Back" />
            </div>
			<div data-role="content" data-theme="a">
                <div id="feedbackParagraphs" class="contentElement advancedElement">
				    <p id="demo">Demo feedback</p>
				    <p id="description">Description paragraph</p>
                    <p id="newFeedBack">New Feedback Paragraph</p>
                    <p id="newFeedBack2">New Feedback Paragraph2</p>
                </div>
                
                <div id="pacerSelectDiv" class="contentElement">
                    <input id="pacerSelect" type="button" class="btn ui-btn-icon-right" href="#" data-role="button" style="background-color:#E6E6E6" data-icon="carat-d" value="Select Pacer: All Pacers" />
                </div>
				
                <div id="feedbackParagraph2" class="contentElement">		
				    <p id="feedbackData">Lap Time: ----, Color: ----- </p>
                </div>

                <div id="pacerTimeInputDiv" class="contentElement timeInputView">
				    <label for="select-choice-a" class="select"><h3>Enter Lap Time in Seconds: <a href="#" id="helpLink">Help?</a></h3></label>
				    <input type="number" pattern="[0-9]*" name="name" id="pacerTimeInput" value="Lap Time Input" step="0.1" min="1" max="900" url="7" />
                    <input id="pacerTimeSubmit" type="button" url="7" otherNum="1" data-icon="arrow-r" data-iconpos="right" style="background-color:#00ff21" value="<h3>Go!</h3>" />
				</div>

                <!-- Simple Pacer control buttons for first time end user -->
                <div id="simpleViewActionButtonsDiv" class="contentElement advancedElement">
                    <input id="clearButtonMasses" type="button" class="submitButton3" url="0" otherNum="0" data-icon="delete" style="background-color:#f53434" data-iconpos="right" value="<h3>Quit</h3>" />
                    <input id="resetButtonMasses" type="button"  class="submitButton3" url="2" otherNum="0" data-icon="clock" style="background-color:yellow" data-iconpos="right" value="<h3>Reset Countdown</h3>" />
                    <input id="helpButtonMasses" type="button" data-icon="info" style="background-color:blue" data-iconpos="right" value="<h3>Help</h3>" />
                </div>

				<div class="submitButton2 contentElement" style="width:23%">
                    <input id="clearButton" type="button" class="submitButton3" url="0" otherNum="0" data-mini="true" data-icon="delete" data-iconpos="top" />
				</div>
				<div class="submitButton2 contentElement" style="width:23%">
                    <input id="resetButton" type="button" class="submitButton3" url="2" otherNum="0" data-mini="true" data-icon="clock" data-iconpos="top" />
				</div>
				<div class="submitButton2 contentElement" style="width:23%">
                    <input id="visibleButton" type="button" class="submitButton3" url="3" otherNum="0" data-mini="true" data-icon="eye" data-iconpos="top" />
				</div>
				<div class="submitButton2 contentElement" style="width:23%">
                    <input id="backwardsButton" type="button" class="submitButton3" url="4" otherNum="0" data-mini="true" data-icon="back" data-iconpos="top" />
				</div>
				
                <div id="colorSelectDiv" class="contentElement" >
                    <input id="colorSelect" type="button" class="btn ui-btn-icon-right" href="#" data-role="button" style="background-color:#E6E6E6" data-icon="carat-d" value="Select Color" />
                </div>	
				
                <div id="pacerActionGroup" class="contentElement" >	
				    <div class="submitButton2" style="width:23%">
                        <input id="lightsSubmit" type="button" url="6" otherNum="99" type="submit" data-mini="true" data-theme="a" data-icon="grid" data-iconpos="top" />
				    </div>
				    <div class="submitButton2" style="width:23%">
                        <input id="accelerate" type="button" url="8" otherNum="-1.0" class="speedChangeButton" type="submit" data-mini="true" data-theme="a" data-icon="arrow-u" data-iconpos="top" />
				    </div>
				    <div class="submitButton2" style="width:23%">
                        <input id="slow" type="button" url="8" otherNum="1.0" class="speedChangeButton" type="submit" data-mini="true" data-theme="a" data-icon="arrow-d" data-iconpos="top" />
				    </div>
                    <div class="submitButton2" style="width:23%">
                        <input id="helpButton" type="button" url="-1" otherNum="99" type="submit" data-mini="true" data-theme="a" data-icon="info" data-iconpos="top" />
				    </div>
				
				    <div>
					    <input class="lightChange" data-mini="true" type="number" name="name" id="lightsNumberInput" oldurl="lights" url="6" value="2" min="0.1" max="100.0" step="0.1" />
				    </div>
                </div>

                <div id="resetYunFromDb" class="contentElement advancedElement" >
                    <a id="resetYunFromDbButton" class="btn" url="-1" otherNum="1" data-role="button">Reset Yun DB</a>
				</div>
				
                <div id="advancedButtonDiv" data-role="fieldcontain" class="contentElement">
					<input id="advancedButton" type="button" data-icon="gear" data-iconpos="notext" url="clear" data-theme="a" />
				</div>	
				
				<div id="existingPacerSelectHeader" class="contentElement advancedElement" >
					<h3>Select your pacer</h3>
				</div>
				
                <div id="pacerButtonView" class="contentElement advancedElement" >
                    <a id="allPacersButton" class="pacerButtonClass" otherNum="99" data-role="button" style="background-color:#E6E6E6" data-icon="star">Select Pacers: All Pacers</a>
                    <a href="#" id="pacerButton0" class="btn pacerButtonClass" otherNum="0" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton1" class="btn pacerButtonClass" otherNum="1" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton2" class="btn pacerButtonClass" otherNum="2" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton3" class="btn pacerButtonClass" otherNum="3" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton4" class="btn pacerButtonClass" otherNum="4" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton5" class="btn pacerButtonClass" otherNum="5" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton6" class="btn pacerButtonClass" otherNum="6" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton7" class="btn pacerButtonClass" otherNum="7" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton8" class="btn pacerButtonClass" otherNum="8" data-role="button" data-icon="star"></a>
                    <a href="#" id="pacerButton9" class="btn pacerButtonClass" otherNum="9" data-role="button" data-icon="star"></a>
                </div>

                <!--<div id="colorViewEscape" class="contentElement advancedElement" >
                    <a id="colorViewEscapeButton" data-role="button" data-icon="arrow-l" style="background-color:#E6E6E6">Back</a>
                </div>-->
                    
                <div id="colorButtonView" class="contentElement advancedElement" >
                    <a id="normalColorsButton" class="colorButtonClass" otherNum="99" data-role="button" data-icon="star" style="background-color:#E6E6E6">Normal Colors</a>
                    <a id="colorButton0" class="btn colorButtonClass" otherNum="1" data-role="button" data-icon="star"></a>
                    <a id="colorButton1" class="btn colorButtonClass" otherNum="2" data-role="button" data-icon="star"></a>
                    <a id="colorButton2" class="btn colorButtonClass" otherNum="3" data-role="button" data-icon="star"></a>
                    <a id="colorButton3" class="btn colorButtonClass" otherNum="4" data-role="button" data-icon="star"></a>
                    <a id="colorButton4" class="btn colorButtonClass" otherNum="5" data-role="button" data-icon="star"></a>
                    <a id="colorButton5" class="btn colorButtonClass" otherNum="6" data-role="button" data-icon="star"></a>
                    <a id="colorButton6" class="btn colorButtonClass" otherNum="7" data-role="button" data-icon="star"></a>
                </div>

                <div id="writeFileModeDiv" class="contentElement advancedElement" >
                    <button id="writeFileMode" style="background-color:lightgreen">Write Mode On/Off</button>
                </div>
                <div id="lightStripModeDiv" class="contentElement advancedElement" >
                    <button id="lightStripMode" style="background-color:#E6E6E6">Light Strip Mode Toggle</button>
                </div>

                <!-- Start View for the first time users -->
                <div id="firstTimeUserStartDiv" class="contentElement advancedElement" >
                    <br /><br /><br />
                    <?php echo 'David is awesome with PHP';?>
                    <br /><br /><br />
                    <input id="newPacerButton" type="button" class="btn btn-success" otherNum="1" style="background-color:#00ff21" value="<h2>Let's Get Started!</h2>" />
                    <br /><br /><br />
                    <input id="existingPacerButton" type="button" class="btn btn-danger" otherNum="2" style="background-color:#f00" value="<h3>Wait, my light is running.</h3>" />
                </div>

                <div id="createPinView" class="contentElement advancedElement" >
                    <br /><br /><br />
                    <h3 for="createPinSubmit" class="">Create your 3 digit passcode: </h3>
                    <input type="number" pattern="[0-9]*" name="name" id="pinInputField" value="3 Digit Passcode Input" step="1" min="0" max="999" url="" />
                    <br /><br /><br />
                    <input id="createPinSubmit" type="button" class="btn" otherNum="2" data-role="button" style="background-color:#f00" value="<h2>Create!</h2>" />
                </div>

                <div id="pacerTimeInputSimpleDiv" class="contentElement advancedElement">
				    <label for="select-choice-a" class="select">Enter Lap Time in Seconds: <a href="#" id="A1">Help?</a></label>
				    <input type="number" pattern="[0-9]*" name="name" id="pacerTimeInputSimple" value="Lap Time Input" step="0.1" min="1" max="900" url="7" />
                    <a id="pacerTimeSubmitSimple" class="btn" url="7" otherNum="1" data-role="button" style="background-color:#00ff21">Go!</a>
				</div>

                <div id="pacerOccupiedDiv" class="contentElement advancedElement">
                    <h3>No Light Pacers Available: All are currently in use.</h3>
                </div>

                <div id="pacerListView" class="contentElement advancedElement" >
                    <ul data-role="listview" data-inset="true" data-divider-theme="a">
					    <li data-role="list-divider">Swatch A</li>
					    <li data-icon="gear"><a href="">A list item</a></li>
				    </ul>

				    <ul data-role="listview" data-inset="true" data-divider-theme="b">
					    <li data-role="list-divider">Swatch B</li>
					    <li data-icon="info"><a href="">A list item</a></li>
				    </ul>

				    <ul data-role="listview" data-inset="true" data-divider-theme="c">
					    <li data-role="list-divider">Swatch C</li>
					    <li data-icon="check"><a href="">A list item</a></li>
				    </ul>

				    <ul data-role="listview" data-inset="true" data-divider-theme="d">
					    <li data-role="list-divider">Swatch D</li>
					    <li data-icon="grid"><a href="">A list item</a></li>
				    </ul>

				    <ul data-role="listview" data-inset="true" data-divider-theme="e">
					    <li data-role="list-divider">Swatch E</li>
					    <li data-icon="alert"><a href="">A list item</a></li>
				    </ul>

				    <ul data-role="listview" data-inset="true" data-divider-theme="f">
					    <li data-role="list-divider">Swatch F</li>
					    <li data-icon="refresh"><a href="">A list item</a></li>
				    </ul>
                </div>

                <div id="pacerTrueButtonView" class="contentElement advancedElement" >
                    <button style="background-color:lightgreen">Button</button>
                </div>
                	
				<div id="slider2" class="contentElement advancedElement" data-role="fieldcontain">
					<label for="slider2">Invisible</label>
					<select name="slider2" id="Select1" class="flipSwitch" data-role="slider">
						<option myURL="/visible/99" onclick="flipSwitchChange(this.myURL)" value="off">Off</option>
						<option myURL="/visible/99" onclick="flipSwitchChange(this.myURL)" value="on">On</option>
					</select>
					<label for="slider3">Backwards</label>
					<select name="slider3" id="slider3" class="flipSwitch" data-role="slider">
						<option myURL="/backwards/99" onclick="flipSwitchChange(this.myURL)" value="off">Off</option>
						<option myURL="/backwards/99" onclick="flipSwitchChange(this.myURL)" value="on">On</option>
					</select>
				</div>

				<div id="slider1" class="contentElement advancedElement" data-role="fieldcontain">
					<label for="slider">Slider:</label>
					<input type="range" name="slider" id="slider" value="50" min="0" max="100" step="0.1" data-highlight="true"  />
				</div>

				<div id="snacks" class="contentElement advancedElement" data-role="fieldcontain">
					<fieldset data-role="controlgroup">
						<legend>Choose as many snacks as you'd like:</legend>
						<input type="checkbox" name="checkbox-1a" id="checkbox-1a" class="custom" />
						<label for="checkbox-1a">Cheetos</label>

						<input type="checkbox" name="checkbox-2a" id="checkbox-2a" class="custom" />
						<label for="checkbox-2a">Doritos</label>

						<input type="checkbox" name="checkbox-3a" id="checkbox-3a" class="custom" />
						<label for="checkbox-3a">Fritos</label>

						<input type="checkbox" name="checkbox-4a" id="checkbox-4a" class="custom" />
						<label for="checkbox-4a">Sun Chips</label>
					</fieldset>
				</div>

				<div id="fontStyle" class="contentElement advancedElement" data-role="fieldcontain">
					<fieldset data-role="controlgroup" data-type="horizontal">
					    <legend>Font styling:</legend>
					    <input type="checkbox" name="checkbox-6" id="checkbox-6" class="custom" />
						<label for="checkbox-6">b</label>

						<input type="checkbox" name="checkbox-7" id="checkbox-7" class="custom" />
						<label for="checkbox-7"><em>i</em></label>

						<input type="checkbox" name="checkbox-8" id="checkbox-8" class="custom" />
						<label for="checkbox-8">u</label>
					</fieldset>
				</div>

				<div id="colorRadio" class="contentElement advancedElement" data-role="fieldcontain">
					<fieldset data-role="controlgroup">
					    <legend>Color:</legend>
						<input type="radio" name="radio-choice-1" id="radio-choice-1" value="/color/1" checked="checked" />
						<label for="radio-choice-1">White</label>

						<input type="radio" name="radio-choice-1" id="radio-choice-2" value="/color/2"  />
						<label for="radio-choice-2">Green</label>

						<input type="radio" name="radio-choice-1" id="radio-choice-3" value="/color/3"  />
						<label for="radio-choice-3">Yellow</label>

						<input type="radio" name="radio-choice-1" id="radio-choice-4" value="/color/4"  />
						<label for="radio-choice-4">Red</label>
					</fieldset>
				</div>

				<div id="colorRadioB" class="contentElement advancedElement" data-role="fieldcontain">
					<fieldset data-role="controlgroup" data-type="horizontal">
						<legend>Color:</legend>
						<input type="radio" name="radio-choice-b" id="radio-choice-c" value="on" checked="checked" />
						<label for="radio-choice-c">WHT</label>
						<input type="radio" name="radio-choice-b" id="radio-choice-d" value="off" />
						<label for="radio-choice-d">GRN</label>
						<input type="radio" name="radio-choice-b" id="radio-choice-e" value="off" />
						<label for="radio-choice-e">YLW</label>
						<input type="radio" name="radio-choice-b" id="radio-choice-f" value="off" />
						<label for="radio-choice-f">RED</label>
					</fieldset>
				</div>

				<div id="selectShipping" class="contentElement advancedElement" data-role="fieldcontain">
					<label for="select-choice-a" class="select">Choose shipping method:</label>
					<select name="select-choice-a" id="select-choice-a" data-native-menu="false">
						<option>Custom menu example</option>
						<option value="standard">Standard: 7 day</option>
						<option value="rush">Rush: 3 days</option>
						<option value="express">Express: next day</option>
						<option value="overnight">Overnight</option>
					</select>
				</div>

				<div id="submitCancel" class="contentElement advancedElement" class="ui-body ui-body-b">
					<fieldset class="ui-grid-a">
						<div class="ui-block-a"><button type="submit" data-theme="d">Cancel</button></div>
						<div class="ui-block-b"><button type="submit" data-theme="a">Submit</button></div>
					</fieldset>
				</div>

			</div>
		</div>
		
		<a href="https://github.com/commadelimited/jQuery-Mobile-Bootstrap-Theme" data-role="button" data-icon="star">Get the code</a>
	</body>
</html>